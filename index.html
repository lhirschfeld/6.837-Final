<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script src="js/noise.js"></script>

		<script>
            const greyscaleChannel = (octave, width, height) => {
                perlin = perlin_grid(2, octave, [width, height]);
                const data = new Uint8Array(3 * width * height);
                for (let i = 0; i < width; i++) {
                    for (let j = 0; j < height; j++) {
                        let grey = Math.floor((perlin[i][j] + 1) * 255 / 2);
                        data[3 * (i * width + j)] = grey;
                        data[3 * (i * width + j) + 1] = grey;
                        data[3 * (i * width + j) + 2] = grey;
                    }
                }
                return data;
            }

            const multilayerGreyscaleChannel = (octaves, weights, width, height) => {
                const data = new Uint8Array(3 * width * height);
                for (let i = 0; i < octaves.length; i++) {
                    let octave = greyscaleChannel(octaves[i], width, height);
                    for (let j = 0; j < octave.length; j++) {
                        data[j] += Math.floor(weights[i] * octave[j]);
                    }
                }

                return data;
            }
			const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
            camera.position.z = 4;

            const renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );

            // const light = new THREE.AmbientLight( 0x333333 ); // soft white light
            // scene.add( light );

            const directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );
            directionalLight.position.x = 3;
            directionalLight.position.z = 2;
            scene.add( directionalLight );
    
            // const helper = new THREE.DirectionalLightHelper( directionalLight, 1 );
            // scene.add( helper );

            const geometry = new THREE.SphereGeometry( 2, 32, 32 );
            const texture = new THREE.DataTexture(multilayerGreyscaleChannel([16, 32, 64, 128], [0.4, 0.3, 0.2, 0.1], 1000, 1000), 1000, 1000, THREE.RGBFormat);
            const material = new THREE.MeshPhongMaterial( {map: texture} );
            const sphere = new THREE.Mesh( geometry, material );
            scene.add( sphere );

            function animate() {
                // requestAnimationFrame( animate );
                renderer.render( scene, camera );
            }
            animate();
		</script>
	</body>
</html>